{{ define "content" }}
<div class="min-h-screen bg-slate-100 pl-0 md:pl-64 fade-in font-sans">

    <!-- Sidebar -->
    <aside class="hidden md:block fixed left-0 top-0 h-full w-64 bg-slate-900 text-white z-10 shadow-xl">
        <div class="p-6 text-2xl font-bold tracking-tight text-white flex items-center gap-2 border-b border-slate-800">
            <i class="fas fa-network-wired text-blue-500"></i> IT<span class="text-blue-500">OPS</span>
        </div>
        <nav class="p-4 space-y-2 mt-4">
            <a href="javascript:void(0)" onclick="switchManagerTab('dashboard')" id="mgr-nav-dashboard"
                class="flex items-center gap-3 px-4 py-3 bg-blue-600 rounded-lg text-white font-medium shadow-lg shadow-blue-900/50 cursor-pointer transition">
                <i class="fas fa-chart-pie w-5 text-center"></i> Dashboard
            </a>
            <a href="javascript:void(0)" onclick="switchManagerTab('shifts')" id="mgr-nav-shifts"
                class="flex items-center gap-3 px-4 py-3 text-slate-400 hover:text-white hover:bg-slate-800 rounded-lg transition cursor-pointer">
                <i class="fas fa-calendar-alt w-5 text-center"></i> Shift Management
            </a>
            <a href="javascript:void(0)" onclick="switchManagerTab('bigbook')" id="mgr-nav-bigbook"
                class="flex items-center gap-3 px-4 py-3 text-slate-400 hover:text-white hover:bg-slate-800 rounded-lg transition cursor-pointer">
                <i class="fas fa-book w-5 text-center"></i> Big Book Wiki
            </a>
            <a href="javascript:void(0)" onclick="switchManagerTab('performance')" id="mgr-nav-performance"
                class="flex items-center gap-3 px-4 py-3 text-slate-400 hover:text-white hover:bg-slate-800 rounded-lg transition cursor-pointer">
                <i class="fas fa-users-cog w-5 text-center"></i> Staff Performance
            </a>
            <a href="javascript:void(0)" onclick="switchManagerTab('routines')" id="mgr-nav-routines"
                class="flex items-center gap-3 px-4 py-3 text-slate-400 hover:text-white hover:bg-slate-800 rounded-lg transition cursor-pointer">
                <i class="fas fa-clipboard-list w-5 text-center"></i> Routines
            </a>
            <a href="/auth/logout"
                class="flex items-center gap-3 px-4 py-3 text-red-400 hover:text-red-200 hover:bg-slate-800 rounded-lg transition cursor-pointer mt-8">
                <i class="fas fa-sign-out-alt w-5 text-center"></i> Logout
            </a>
        </nav>
    </aside>

    <!-- Main Content Area -->
    <main class="p-8 max-w-7xl mx-auto">

        <!-- 3.1 DASHBOARD HOME -->
        <div id="manager-content-dashboard" class="fade-in slide-up">
            <div class="flex justify-between items-center mb-8">
                <div>
                    <h2 class="text-2xl font-bold text-slate-800">Operational Dashboard</h2>
                    <p class="text-slate-500 text-sm">Pantauan real-time KPI & Shift</p>
                </div>
                <div class="flex gap-3">
                    <!-- Dropdown Filter Aktif -->
                    <select onchange="window.location.href='?period=' + this.value"
                        class="bg-white border border-slate-300 px-4 py-2 rounded-lg text-sm font-bold text-slate-600 hover:bg-slate-50 shadow-sm cursor-pointer outline-none focus:ring-2 focus:ring-blue-500">
                        <option value="this_month" {{ if eq .period "this_month" }}selected{{ end }}>This Month</option>
                        <option value="last_month" {{ if eq .period "last_month" }}selected{{ end }}>Last Month</option>
                    </select>

                    <button
                        class="bg-white border border-slate-300 px-4 py-2 rounded-lg text-sm font-bold text-slate-600 hover:bg-slate-50 shadow-sm">
                        <i class="fas fa-download mr-2"></i> Report
                    </button>
                    <button onclick="openModal('new-shift-modal')"
                        class="bg-blue-600 px-4 py-2 rounded-lg text-sm font-bold text-white hover:bg-blue-700 shadow-sm shadow-blue-200">
                        <i class="fas fa-plus mr-2"></i> New Shift
                    </button>
                </div>
            </div>

            <!-- KPI Cards -->
            <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
                <!-- MTTA -->
                <div class="bg-white p-6 rounded-xl shadow-sm border-t-4 border-blue-500 hover-scale cursor-default">
                    <p class="text-xs font-bold text-slate-400 uppercase tracking-wider">Avg Response (MTTA)</p>
                    <div class="mt-2 flex items-baseline gap-2">
                        <span class="text-3xl font-bold text-slate-800">{{ .mtta }}m</span>
                        <span class="text-xs text-green-500 font-bold bg-green-50 px-1.5 py-0.5 rounded"><i
                                class="fas fa-arrow-down"></i> Live</span>
                    </div>
                </div>
                <!-- MTTR -->
                <div class="bg-white p-6 rounded-xl shadow-sm border-t-4 border-purple-500 hover-scale cursor-default">
                    <p class="text-xs font-bold text-slate-400 uppercase tracking-wider">Avg Resolution (MTTR)</p>
                    <div class="mt-2 flex items-baseline gap-2">
                        <span class="text-3xl font-bold text-slate-800">{{ .mttr }}m</span>
                        <span class="text-xs text-slate-400 font-bold bg-slate-50 px-1.5 py-0.5 rounded">All Time</span>
                    </div>
                </div>
                <!-- FCR -->
                <div class="bg-white p-6 rounded-xl shadow-sm border-t-4 border-green-500">
                    <p class="text-xs font-bold text-slate-400 uppercase tracking-wider">First Contact Res.</p>
                    <div class="mt-2 flex items-baseline gap-2">
                        <span class="text-3xl font-bold text-slate-800">{{ .fcr }}%</span>
                        <span class="text-xs text-slate-400">Target: 80%</span>
                    </div>
                </div>
                <!-- Big Book -->
                <div class="bg-white p-6 rounded-xl shadow-sm border-t-4 border-orange-500">
                    <p class="text-xs font-bold text-slate-400 uppercase tracking-wider">Big Book Articles</p>
                    <div class="mt-2 flex items-baseline gap-2">
                        <span class="text-3xl font-bold text-slate-800">{{ .articleCount }}</span>
                        {{ if gt .newArticlesCount 0 }}
                        <span class="text-xs text-blue-500 font-bold bg-blue-50 px-1.5 py-0.5 rounded">+{{
                            .newArticlesCount }} Pending</span>
                        {{ end }}
                    </div>
                </div>


            </div>

            <div class="bg-white p-6 rounded-xl shadow-sm border border-slate-200 mb-8">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="font-bold text-slate-800 flex items-center gap-2">
                        <i class="fas fa-chart-line text-blue-500"></i> Weekly Ticket Trend
                    </h3>
                    <div class="flex gap-2">
                        <span class="text-xs flex items-center gap-1"><span
                                class="w-3 h-3 bg-blue-500 rounded-full"></span> Incoming</span>
                        <span class="text-xs flex items-center gap-1"><span
                                class="w-3 h-3 bg-green-500 rounded-full"></span> Resolved</span>
                    </div>
                </div>
                <div class="h-64 w-full">
                    <canvas id="kpiChart"></canvas>
                </div>
            </div>

            <!-- SLA Compliance Section -->
            <div class="grid grid-cols-1 mb-8" style="animation-delay: 100ms;">
                <h3 class="font-bold text-slate-800 mb-4 flex items-center gap-2"><i
                        class="fas fa-clipboard-check text-blue-500"></i> SLA Compliance Report</h3>
                <div class="bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden">
                    <table class="w-full text-left text-sm">
                        <thead class="bg-slate-50 border-b border-slate-200 text-slate-500 uppercase font-bold text-xs">
                            <tr>
                                <th class="p-4">Category</th>
                                <th class="p-4">Target (Res)</th>
                                <th class="p-4 text-center">Total Tickets</th>
                                <th class="p-4 text-center">Compliant</th>
                                <th class="p-4 text-center">Rate</th>
                            </tr>
                        </thead>
                        <tbody class="divide-y divide-slate-100">
                            {{ range .slaMetrics }}
                            <tr class="hover:bg-slate-50 transition">
                                <td class="p-4 font-bold text-slate-700">
                                    {{ if eq .Priority "URGENT_ON_AIR" }}
                                    <span class="text-red-600"><i class="fas fa-broadcast-tower mr-2 w-4"></i>Urgent
                                        (On Air)</span>
                                    {{ else }}
                                    <span class="text-blue-600"><i class="fas fa-briefcase mr-2 w-4"></i>Normal /
                                        High</span>
                                    {{ end }}
                                </td>
                                <td class="p-4 text-slate-500 text-xs">
                                    {{ if eq .Priority "URGENT_ON_AIR" }} < 15 Mins {{ else }} < 8 Hours {{ end }} </td>
                                <td class="p-4 text-center text-slate-800 font-bold">{{ .TotalTickets }}</td>
                                <td class="p-4 text-center text-green-600 font-bold">{{ .CompliantTickets }}</td>
                                <td class="p-4 text-center">
                                    <div class="flex items-center justify-center gap-2">
                                        <span
                                            class="font-bold {{ if ge .ComplianceRate 90.0 }}text-green-600{{ else if ge .ComplianceRate 75.0 }}text-yellow-600{{ else }}text-red-600{{ end }}">
                                            {{ printf "%.1f" .ComplianceRate }}%
                                        </span>
                                        <!-- Progress Bar -->
                                        <div class="w-16 h-1.5 bg-slate-100 rounded-full overflow-hidden">
                                            <div class="h-full {{ if ge .ComplianceRate 90.0 }}bg-green-500{{ else if ge .ComplianceRate 75.0 }}bg-yellow-500{{ else }}bg-red-500{{ end }}"
                                                style="width: {{ .ComplianceRate }} %"></div>
                                        </div>
                                    </div>
                                </td>
                            </tr>
                            {{ else }}
                            <tr>
                                <td colspan="5" class="p-6 text-center text-slate-400 italic">No tickets to analyze
                                    yet.</td>
                            </tr>
                            {{ end }}
                        </tbody>
                    </table>
                </div>
            </div>



            <!-- Quick Overview Section -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <div class="bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden">
                    <div class="p-6 border-b border-slate-100 flex justify-between items-center bg-slate-50">
                        <h3 class="font-bold text-slate-800">Active Shift</h3>
                        {{ if .hasActiveShift }}
                        <span class="text-xs font-bold bg-green-100 text-green-700 px-2 py-1 rounded">{{
                            .activeShift.Label }} ({{ .activeShift.StartTime.Format "15:04" }} - {{
                            .activeShift.EndTime.Format "15:04" }})</span>
                        {{ else }}
                        <span class="text-xs font-bold bg-slate-100 text-slate-500 px-2 py-1 rounded">No Active
                            Shift</span>
                        {{ end }}
                    </div>
                    <div class="p-6">
                        {{ if .hasActiveShift }}
                        <div class="flex items-center justify-between mb-4">
                            <div class="flex items-center gap-3">
                                <div class="relative">
                                    <img src="{{ if .activeShift.User.AvatarURL }}{{ .activeShift.User.AvatarURL }}{{ else }}https://ui-avatars.com/api/?name={{ .activeShift.User.FullName }}&background=random{{ end }}"
                                        class="w-10 h-10 rounded-full">
                                    <div
                                        class="absolute bottom-0 right-0 w-3 h-3 bg-green-500 border-2 border-white rounded-full">
                                    </div>
                                </div>
                                <div>
                                    <p class="text-sm font-bold text-slate-800">{{ .activeShift.User.FullName }}</p>
                                    <p class="text-xs text-slate-500">Currently On Duty</p>
                                </div>
                            </div>
                            <button
                                class="text-xs border border-slate-200 px-2 py-1 rounded hover:bg-slate-50">Detail</button>
                        </div>
                        {{ else }}
                        <div class="text-center py-4 text-slate-400 text-sm">
                            <p>Tidak ada staff yang sedang shift saat ini.</p>
                        </div>
                        {{ end }}
                        <button onclick="switchManagerTab('shifts')"
                            class="w-full text-center text-sm text-blue-600 font-bold py-2 hover:bg-blue-50 rounded-lg transition">Lihat
                            Jadwal Lengkap</button>
                    </div>
                </div>

                <div class="bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden">
                    <div class="p-6 border-b border-slate-100 flex justify-between items-center bg-slate-50">
                        <h3 class="font-bold text-slate-800">Pending Approval</h3>
                        <span class="text-xs font-bold bg-orange-100 text-orange-700 px-2 py-1 rounded">{{
                            .newArticlesCount }} Articles</span>
                    </div>
                    <div class="divide-y divide-slate-100">
                        {{ range .pendingArticles }}
                        <div class="p-4 hover:bg-slate-50 cursor-pointer" onclick="switchManagerTab('bigbook')">
                            <h4 class="font-bold text-sm text-slate-700">{{ .Title }}</h4>
                            <p class="text-xs text-slate-500">Author: {{ .Author.FullName }} &bull; {{ .CreatedAt.Format
                                "15:04" }}</p>
                        </div>
                        {{ else }}
                        <div class="p-6 text-center text-slate-400 text-sm">
                            Tidak ada artikel yang perlu verifikasi.
                        </div>
                        {{ end }}
                    </div>
                </div>
            </div>
        </div>

        <!-- 3.2 SHIFT MANAGEMENT VIEW (UNCHANGED) -->
        <div id="manager-content-shifts" class="hidden fade-in">
            <!-- ... existing content ... -->
            <div class="flex justify-between items-center mb-6">
                <div>
                    <h2 class="text-2xl font-bold text-slate-800">Shift Management</h2>
                    <p class="text-slate-500 text-sm">Atur jadwal teknisi mingguan</p>
                </div>
                <button onclick="openModal('new-shift-modal')"
                    class="bg-blue-600 px-4 py-2 rounded-lg text-sm font-bold text-white hover:bg-blue-700 shadow-sm shadow-blue-200">
                    <i class="fas fa-plus mr-2"></i> Add Shift
                </button>
            </div>

            <!-- CSV Import -->
            <form action="/manager/shifts/import" method="POST" enctype="multipart/form-data" class="mb-6">
                <div onclick="document.getElementById('scheduleInfo').click()"
                    class="border-2 border-dashed border-slate-300 rounded-xl p-8 text-center bg-slate-50 mb-6 hover:bg-blue-50 hover:border-blue-400 transition cursor-pointer group relative">
                    <input type="file" name="schedule" id="scheduleInfo" class="hidden" accept=".csv"
                        onchange="this.form.submit()">

                    <i class="fas fa-file-csv text-4xl text-slate-300 mb-3 group-hover:text-blue-500 transition"></i>
                    <p class="text-sm font-bold text-slate-600">Click to Upload Schedule CSV</p>
                    <p class="text-xs text-slate-400 mt-1">Format: email, label, start_time, end_time</p>
                </div>
                <div class="text-center mt-2">
                    <a href="/static/downloads/shift_template.csv" download
                        class="inline-block text-xs text-blue-500 hover:text-blue-700 font-bold">
                        <i class="fas fa-download mr-1"></i> Download Template
                    </a>
                </div>
            </form>

            <!-- Schedule Table -->
            <div class="bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden">
                <table class="w-full text-sm text-left">
                    <thead class="text-xs text-slate-500 uppercase bg-slate-50 border-b border-slate-200">
                        <tr>
                            <th class="px-6 py-4">Day / Date</th>
                            <th class="px-6 py-4">Time</th>
                            <th class="px-6 py-4">Staff</th>
                            <th class="px-6 py-4">Shift Name</th>
                        </tr>
                    </thead>
                    <tbody class="divide-y divide-slate-100">
                        {{ range .upcomingShifts }}
                        <tr class="hover:bg-slate-50 transition">
                            <td class="px-6 py-4 font-medium text-blue-700">{{ .DateStr }}</td>
                            <td class="px-6 py-4 text-slate-600">{{ .TimeStr }}</td>
                            <td class="px-6 py-4 font-medium flex items-center gap-2">
                                <img src="{{ if .AvatarURL }}{{ .AvatarURL }}{{ else }}https://ui-avatars.com/api/?name={{ .StaffName }}&background=random{{ end }}"
                                    class="w-6 h-6 rounded-full object-cover">
                                {{ .StaffName }}
                            </td>
                            <td class="px-6 py-4"><span
                                    class="{{ .StatusClass }} px-2 py-1 rounded text-xs font-bold">{{ .Label
                                    }}</span>
                            </td>
                        </tr>
                        {{ else }}
                        <tr>
                            <td colspan="4" class="px-6 py-8 text-center text-slate-400">Belum ada jadwal minggu ini.
                            </td>
                        </tr>
                        {{ end }}
                    </tbody>
                </table>
            </div>
        </div>

        <!-- 3.3 BIG BOOK WIKI VIEW -->
        <div id="manager-content-bigbook" class="hidden fade-in">
            <div class="flex justify-between items-center mb-6">
                <div>
                    <h2 class="text-2xl font-bold text-slate-800">Big Book Wiki</h2>
                    <p class="text-slate-500 text-sm">Knowledge Base & Approval System</p>
                </div>
            </div>

            <!-- Approval Queue -->
            <div class="bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden mb-8">
                <div class="p-4 border-b border-slate-100 bg-orange-50 flex items-center gap-2">
                    <i class="fas fa-clock text-orange-500"></i>
                    <h3 class="font-bold text-orange-800 text-sm">Pending Verification ({{ .newArticlesCount }})</h3>
                </div>
                <div class="divide-y divide-slate-100">
                    {{ range .pendingArticles }}
                    <div class="p-5 flex justify-between items-start">
                        <div>
                            <h4 class="font-bold text-lg text-slate-800">{{ .Title }}</h4>
                            <p class="text-sm text-slate-500 mt-1">Author: <span class="font-bold text-slate-700">{{
                                    .Author.FullName }}</span> &bull; {{ .CreatedAt.Format "02 Jan 2006" }}</p>
                            <p
                                class="text-sm text-slate-600 mt-2 bg-slate-50 p-2 rounded border border-slate-100 italic">
                                {{ .Category }}</p>
                        </div>
                        <div class="flex gap-2">
                            <form action="/manager/articles/{{ .ID }}/verify" method="POST">
                                <button type="submit"
                                    class="bg-green-600 text-white px-4 py-2 rounded-lg text-xs font-bold hover:bg-green-700">Approve</button>
                            </form>
                            <button
                                class="border border-slate-300 text-slate-600 px-4 py-2 rounded-lg text-xs font-bold hover:bg-slate-50">Edit</button>
                        </div>
                    </div>
                    {{ else }}
                    <div class="p-6 text-center text-slate-400">Tidak ada artikel pending.</div>
                    {{ end }}
                </div>
            </div>

            <!-- Published List -->
            <h3 class="font-bold text-slate-700 mb-4">Published Articles</h3>
            <div class="bg-white rounded-xl shadow-sm border border-slate-200">
                <table class="w-full text-sm text-left">
                    <thead class="bg-slate-50 text-slate-500 border-b border-slate-200">
                        <tr>
                            <th class="px-6 py-3">Title</th>
                            <th class="px-6 py-3">Category</th>
                            <th class="px-6 py-3">Views</th>
                            <th class="px-6 py-3">Action</th>
                        </tr>
                    </thead>
                    <tbody class="divide-y divide-slate-100">
                        {{ range .publishedArticles }}
                        <tr>
                            <td class="px-6 py-3 font-medium text-blue-600 hover:underline cursor-pointer">{{ .Title }}
                            </td>
                            <td class="px-6 py-3"><span
                                    class="bg-purple-100 text-purple-700 px-2 py-0.5 rounded text-[10px] font-bold">{{
                                    .Category }}</span></td>
                            <td class="px-6 py-3">{{ .ViewsCount }}</td>
                            <td class="px-6 py-3"><button class="text-slate-400 hover:text-blue-500"><i
                                        class="fas fa-edit"></i></button></td>
                        </tr>
                        {{ else }}
                        <tr>
                            <td colspan="4" class="px-6 py-4 text-center text-slate-400">Belum ada artikel dipublish.
                            </td>
                        </tr>
                        {{ end }}
                    </tbody>
                </table>
            </div>
        </div>

        <!-- 3.4 STAFF PERFORMANCE VIEW -->
        <div id="manager-content-performance" class="hidden fade-in">
            <div class="flex justify-between items-center mb-6">
                <div>
                    <h2 class="text-2xl font-bold text-slate-800">Staff Performance</h2>
                    <p class="text-slate-500 text-sm">Evaluasi KPI Tim IT Support</p>
                </div>
                <div class="flex gap-2">
                    <select class="bg-white border border-slate-300 px-3 py-2 rounded-lg text-sm">
                        <option>This Month</option>
                        <option>Last Month</option>
                    </select>
                </div>
            </div>

            <div class="bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden">
                <table class="w-full text-sm text-left">
                    <thead class="bg-slate-50 text-slate-500 border-b border-slate-200">
                        <tr>
                            <th class="px-6 py-4">Staff Name</th>
                            <th class="px-6 py-4 text-center">Tickets Solved</th>
                            <th class="px-6 py-4 text-center">Avg Response (MTTA)</th>
                            <th class="px-6 py-4 text-center">Avg Resolution (MTTR)</th>
                            <th class="px-6 py-4 text-center">Big Book Contrib</th>
                            <th class="px-6 py-4 text-center">Rating</th>
                        </tr>
                    </thead>
                    <tbody class="divide-y divide-slate-100">
                        {{ range .staffPerformance }}
                        <tr class="hover:bg-slate-50 transition">
                            <td class="px-6 py-4 font-medium flex items-center gap-3">
                                <img src="{{ if .AvatarURL }}{{ .AvatarURL }}{{ else }}https://ui-avatars.com/api/?name={{ .StaffName }}&background=random{{ end }}"
                                    class="w-8 h-8 rounded-full">
                                <div>
                                    <p class="text-sm font-bold text-slate-800">{{ .StaffName }}</p>
                                    <p class="text-xs text-slate-500">{{ .Role }}</p>
                                </div>
                            </td>
                            <td class="px-6 py-4 text-center font-bold text-blue-600">{{ .TicketsSolved }}</td>
                            <td class="px-6 py-4 text-center text-slate-600">{{ .MTTA }}</td>
                            <td class="px-6 py-4 text-center text-slate-600">{{ .MTTR }}</td>
                            <td class="px-6 py-4 text-center font-bold text-green-600">{{ .BigBookContrib }}</td>
                            <td class="px-6 py-4 text-center flex justify-center text-yellow-500">
                                <i class="fas fa-star"></i> {{ .Rating }}
                            </td>
                        </tr>
                        {{ else }}
                        <tr>
                            <td colspan="6" class="px-6 py-8 text-center text-slate-400">Belum ada data performance.
                            </td>
                        </tr>
                        {{ end }}
                    </tbody>
                </table>
            </div>
        </div>

        <!-- 3.5 ROUTINES CONTENT (New Tab) -->
        <div id="manager-content-routines" class="hidden fade-in slide-up">
            <div class="flex justify-between items-center mb-8">
                <div>
                    <h2 class="text-2xl font-bold text-slate-800">Routine Management</h2>
                    <p class="text-slate-500 text-sm">Manage recurring tasks and checklists.</p>
                </div>
                <button onclick="openModal('new-routine-modal')"
                    class="bg-blue-600 px-4 py-2 rounded-lg text-sm font-bold text-white hover:bg-blue-700 shadow-sm shadow-blue-200">
                    <i class="fas fa-plus mr-2"></i> New Routine
                </button>
            </div>

            <div class="bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden">
                <table class="w-full text-sm text-left">
                    <thead class="bg-slate-50 text-slate-500 border-b border-slate-200">
                        <tr>
                            <th class="px-6 py-4">Title</th>
                            <th class="px-6 py-4">Schedule (Cron)</th>
                            <th class="px-6 py-4">Deadline</th>
                            <th class="px-6 py-4 text-center">Active</th>
                            <th class="px-6 py-4 text-center">Actions</th>
                        </tr>
                    </thead>
                    <tbody class="divide-y divide-slate-100">
                        {{ range .routineTemplates }}
                        <tr class="hover:bg-slate-50 transition">
                            <td class="px-6 py-4 font-bold text-slate-800">{{ .Title }}</td>
                            <td class="px-6 py-4 font-mono text-xs bg-slate-50 rounded text-slate-600">{{ .CronSchedule
                                }}</td>
                            <td class="px-6 py-4">{{ .DeadlineMinutes }} mins</td>
                            <td class="px-6 py-4 text-center">
                                <span
                                    class="bg-green-100 text-green-700 px-2 py-1 rounded text-xs font-bold">ACTIVE</span>
                            </td>
                            <td class="px-6 py-4 text-center">
                                <button class="text-blue-600 hover:text-blue-800 font-bold text-xs">Edit</button>
                            </td>
                        </tr>
                        {{ else }}
                        <tr>
                            <td colspan="5" class="p-8 text-center text-slate-400">No routines defined.</td>
                        </tr>
                        {{ end }}
                    </tbody>
                </table>
            </div>
        </div>

        <!-- NEW SHIFT MODAL (Manager Only) -->
        <div id="new-shift-modal"
            class="hidden fixed inset-0 bg-slate-900/60 z-[80] flex items-center justify-center p-4 fade-in backdrop-blur-sm">
            <div class="bg-white w-full max-w-md rounded-2xl shadow-2xl overflow-hidden">
                <div class="p-6 border-b border-slate-100 flex justify-between items-center bg-slate-50">
                    <h3 class="font-bold text-slate-800">Add New Shift</h3>
                    <button onclick="closeModal('new-shift-modal')"
                        class="text-slate-400 hover:text-red-500 transition">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <!-- Form using Real Data for Staff Dropdown -->
                <form action="/manager/shifts/create" method="POST" class="p-6 space-y-4">
                    <div>
                        <label class="block text-xs font-bold text-slate-500 uppercase tracking-wide mb-2">Staff
                            Name</label>
                        <select name="staff_id"
                            class="w-full p-3 border border-slate-300 rounded-xl text-sm bg-white focus:ring-2 focus:ring-blue-500 outline-none">
                            {{ range .allStaff }}
                            <option value="{{ .ID }}">{{ .FullName }}</option>
                            {{ end }}
                        </select>
                    </div>
                    <div>
                        <label class="block text-xs font-bold text-slate-500 uppercase tracking-wide mb-2">Shift
                            Label</label>
                        <input type="text" name="label" placeholder="e.g. Shift Pagi Special"
                            class="w-full p-3 border border-slate-300 rounded-xl text-sm focus:ring-2 focus:ring-blue-500 outline-none">
                    </div>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-xs font-bold text-slate-500 uppercase tracking-wide mb-2">Start
                                Time</label>
                            <input type="datetime-local" name="start_time"
                                class="w-full p-3 border border-slate-300 rounded-xl text-sm focus:ring-2 focus:ring-blue-500 outline-none">
                        </div>
                        <div>
                            <label class="block text-xs font-bold text-slate-500 uppercase tracking-wide mb-2">End
                                Time</label>
                            <input type="datetime-local" name="end_time"
                                class="w-full p-3 border border-slate-300 rounded-xl text-sm focus:ring-2 focus:ring-blue-500 outline-none">
                        </div>
                    </div>
                    <button type="submit"
                        class="w-full bg-blue-600 text-white py-3 rounded-xl font-bold shadow-lg shadow-blue-200 hover:bg-blue-700 mt-4">
                        Save Schedule
                    </button>
                </form>

                </form>
            </div>
        </div>

        <!-- NEW ROUTINE MODAL -->
        <div id="new-routine-modal"
            class="hidden fixed inset-0 bg-slate-900/60 z-[80] flex items-center justify-center p-4 fade-in backdrop-blur-sm"
            x-data="{ freq: 'DAILY', checklist: [''] }">
            <div class="bg-white w-full max-w-lg rounded-2xl shadow-2xl overflow-hidden max-h-[90vh] flex flex-col">
                <div class="p-6 border-b border-slate-100 flex justify-between items-center bg-slate-50">
                    <h3 class="font-bold text-slate-800">New Routine</h3>
                    <button onclick="closeModal('new-routine-modal')"
                        class="text-slate-400 hover:text-red-500 transition"><i class="fas fa-times"></i></button>
                </div>

                <form action="/manager/routines/create" method="POST"
                    class="p-6 space-y-5 overflow-y-auto custom-scrollbar">

                    <!-- Title -->
                    <div>
                        <label class="block text-xs font-bold text-slate-500 uppercase tracking-wide mb-2">Routine
                            Title</label>
                        <input type="text" name="title" required placeholder="e.g. Daily Studio Check"
                            class="w-full p-3 border border-slate-300 rounded-xl text-sm focus:ring-2 focus:ring-blue-500 outline-none">
                    </div>

                    <!-- Frequency & Time Row -->
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label
                                class="block text-xs font-bold text-slate-500 uppercase tracking-wide mb-2">Frequency</label>
                            <select name="frequency" x-model="freq"
                                class="w-full p-3 border border-slate-300 rounded-xl text-sm bg-white focus:ring-2 focus:ring-blue-500 outline-none">
                                <option value="DAILY">Daily</option>
                                <option value="WEEKLY">Weekly</option>
                                <option value="MONTHLY">Monthly</option>
                            </select>
                        </div>
                        <div>
                            <label
                                class="block text-xs font-bold text-slate-500 uppercase tracking-wide mb-2">Time</label>
                            <input type="time" name="time" required
                                class="w-full p-3 border border-slate-300 rounded-xl text-sm focus:ring-2 focus:ring-blue-500 outline-none">
                        </div>
                    </div>

                    <!-- Conditional Day Inputs -->
                    <div x-show="freq === 'WEEKLY'" class="slide-up">
                        <label class="block text-xs font-bold text-slate-500 uppercase tracking-wide mb-2">Day of
                            Week</label>
                        <select name="day_week"
                            class="w-full p-3 border border-slate-300 rounded-xl text-sm bg-white focus:ring-2 focus:ring-blue-500 outline-none">
                            <option value="1">Monday</option>
                            <option value="2">Tuesday</option>
                            <option value="3">Wednesday</option>
                            <option value="4">Thursday</option>
                            <option value="5">Friday</option>
                            <option value="6">Saturday</option>
                            <option value="0">Sunday</option>
                        </select>
                    </div>

                    <div x-show="freq === 'MONTHLY'" class="slide-up">
                        <label class="block text-xs font-bold text-slate-500 uppercase tracking-wide mb-2">Day of
                            Month</label>
                        <input type="number" name="day_month" min="1" max="31" placeholder="1-31"
                            class="w-full p-3 border border-slate-300 rounded-xl text-sm focus:ring-2 focus:ring-blue-500 outline-none">
                    </div>

                    <!-- Deadline -->
                    <div>
                        <label class="block text-xs font-bold text-slate-500 uppercase tracking-wide mb-2">Submission
                            Deadline (Mins)</label>
                        <input type="number" name="deadline_minutes" value="30"
                            class="w-full p-3 border border-slate-300 rounded-xl text-sm focus:ring-2 focus:ring-blue-500 outline-none">
                    </div>

                    <!-- Dynamic Checklist -->
                    <div class="pt-2 border-t border-slate-100">
                        <div class="flex justify-between items-center mb-3">
                            <label class="block text-xs font-bold text-slate-500 uppercase tracking-wide">Checklist
                                Items</label>
                            <button type="button" @click="checklist.push('')"
                                class="text-xs bg-blue-50 text-blue-600 px-2 py-1 rounded font-bold hover:bg-blue-100 transition">
                                <i class="fas fa-plus mr-1"></i> Add Item
                            </button>
                        </div>

                        <div class="space-y-2">
                            <template x-for="(item, index) in checklist" :key="index">
                                <div class="flex gap-2 slide-up">
                                    <input type="text" name="checklist_items" x-model="checklist[index]"
                                        placeholder="Task description..." required
                                        class="w-full p-2 border border-slate-200 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 outline-none text-slate-600">
                                    <button type="button"
                                        @click="checklist.length > 1 ? checklist.splice(index, 1) : null"
                                        class="text-slate-400 hover:text-red-500 px-2 transition"
                                        :class="{'opacity-50 cursor-not-allowed': checklist.length <= 1}">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                            </template>
                        </div>
                    </div>

                    <button type="submit"
                        class="w-full bg-blue-600 text-white py-3 rounded-xl font-bold shadow-lg shadow-blue-200 hover:bg-blue-700 mt-4 hover-scale">
                        Create Routine
                    </button>
                </form>
            </div>
        </div>

    </main>
</div>

<script>
    const chartLabels = {{ .chartData.Labels }};
    const incomingData = {{ .chartData.Incoming }};
    const resolvedData = {{ .chartData.Resolved }};

    const ctx = document.getElementById('kpiChart').getContext('2d');
    new Chart(ctx, {
        type: 'line',
        data: {
            labels: chartLabels,
            datasets: [
                {
                    label: 'Incoming Tickets',
                    data: incomingData,
                    borderColor: '#3b82f6', // Blue-500
                    backgroundColor: 'rgba(59, 130, 246, 0.1)',
                    borderWidth: 2,
                    tension: 0.4,
                    fill: true
                },
                {
                    label: 'Resolved Tickets',
                    data: resolvedData,
                    borderColor: '#22c55e', // Green-500
                    backgroundColor: 'rgba(34, 197, 94, 0.0)',
                    borderWidth: 2,
                    tension: 0.4,
                    borderDash: [5, 5]
                }
            ]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: { display: false } // Custom legend made with HTML above
            },
            scales: {
                y: {
                    beginAtZero: true,
                    grid: { borderDash: [2, 4], color: '#f1f5f9' }
                },
                x: {
                    grid: { display: false }
                }
            }
        }
    });
    function switchManagerTab(tabName) {
        // Hide all manager content
        ['dashboard', 'shifts', 'bigbook', 'performance', 'routines'].forEach(t => {
            const el = document.getElementById('manager-content-' + t);
            if (el) el.classList.add('hidden');

            // Reset Nav Style
            const nav = document.getElementById('mgr-nav-' + t);
            if (nav) {
                nav.classList.remove('bg-blue-600', 'text-white', 'shadow-lg');
                nav.classList.add('text-slate-400', 'hover:text-white', 'hover:bg-slate-800');
            }
        });

        // Show selected
        const target = document.getElementById('manager-content-' + tabName);
        if (target) target.classList.remove('hidden');

        // Highlight Nav
        const activeNav = document.getElementById('mgr-nav-' + tabName);
        if (activeNav) {
            activeNav.classList.remove('text-slate-400', 'hover:text-white', 'hover:bg-slate-800');
            activeNav.classList.add('bg-blue-600', 'text-white', 'shadow-lg');
        }
    }

    function openModal(id) { document.getElementById(id).classList.remove('hidden'); }
    function closeModal(id) { document.getElementById(id).classList.add('hidden'); }

    // Init Logic: Show Dashboard
    switchManagerTab('dashboard');
</script>
{{ end }}